<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">Fraud Detection | Imbalanced data modeling | LITTLEMEEMOON</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
  <link rel="stylesheet" type="text/css" href="/css/matery.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "Bear CaveKayleen";
  mashiro_option.author_name = "Kayleen";
  mashiro_option.site_url = "https://littlelittlemoon.github.io/";
  mashiro_option.v_appId = "uVn0CbsTzphCnMDIxJKQ0rbg-gzGzoHsz";
  mashiro_option.v_appKey = "wc39UmG3dNqQQms9Hg2sKc1X";
  mashiro_option.mathjax = "[object Object]";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/cover/2/(0).webp,https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/cover/2/(1).webp,https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/cover/2/(2).webp,https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/cover/2/(3).webp,https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/cover/2/(4).webp,https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/cover/2/(5).webp,https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/cover/2/(6).webp,https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/cover/2/(7).webp,https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/cover/2/(8).webp".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="LITTLEMEEMOON" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop ">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://littlelittlemoon.github.io/">
          <img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/custom/avatar-3.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>Do not pray for easy lives, pray to be stronger men.</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/littlelittlemoon" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="mailto:littlemeemoon@gmail.com" target="_blank" class="social-github" title="email">
                    <img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/social/email.svg">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://wpa.qq.com/msgrd?v=3&amp;uin=1165156282&amp;site=qq&amp;menu=yes" target="_blank" class="social-github" title="qq">
                    <img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdnundefined">
                  </a>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">Bear Cave</span>
            <span class="shironeko">Kayleen</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/Technology/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/Life/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/Thoughts/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          随想
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/Repost/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          转载
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/Reading/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          悦读
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          音悦
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/Pictures/">
                          <i class="fa fa-photo" aria-hidden="true"></i>
                          图集
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/Cave/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          Cave
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/donate/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
                    赞赏
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/about/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-meetup" aria-hidden="true"></i>
                    关于我
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/photos/ml/idm_01.png);" src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/photos/ml/idm_01.png">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      Fraud Detection | Imbalanced data modeling</h1>
      <p class="entry-census">
        <span>
          <a href="https://littlelittlemoon.github.io/">
            <img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/custom/avatar-3.jpg">
          </a>
        </span>
        <span>
          <a href="https://littlelittlemoon.github.io/">Kayleen</a>
        </span>
        <span class="bull">
        ·</span>
        2020-3-21<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h1 id="lda-qda-and-lr-for-fraud-detection-imbalanced-data-modeling">LDA, QDA and LR for fraud detection | Imbalanced data modeling</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># import warnings filter</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">from</span> warnings <span class="im">import</span> simplefilter</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># ignore all future warnings</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>simplefilter(action<span class="op">=</span><span class="st">&#39;ignore&#39;</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span></code></pre></div>
<h2 id="prepare-data">prepare data</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># load data</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>default_data <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/Default.csv&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co"># prepare data</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>default_data.loc[default_data[<span class="st">&#39;default&#39;</span>] <span class="op">==</span> <span class="st">&#39;No&#39;</span>, <span class="st">&quot;default&quot;</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>default_data.loc[default_data[<span class="st">&#39;default&#39;</span>] <span class="op">==</span> <span class="st">&#39;Yes&#39;</span>, <span class="st">&quot;default&quot;</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>default_data.loc[default_data[<span class="st">&#39;student&#39;</span>] <span class="op">==</span> <span class="st">&#39;No&#39;</span>, <span class="st">&quot;student&quot;</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>default_data.loc[default_data[<span class="st">&#39;student&#39;</span>] <span class="op">==</span> <span class="st">&#39;Yes&#39;</span>, <span class="st">&quot;student&quot;</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>default_data.describe()</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
Unnamed: 0
</th>
<th>
default
</th>
<th>
student
</th>
<th>
balance
</th>
<th>
income
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
count
</td>
<td>
10000.00000
</td>
<td>
10000.000000
</td>
<td>
10000.000000
</td>
<td>
10000.000000
</td>
<td>
10000.000000
</td>
</tr>
<tr>
<td>
mean
</td>
<td>
5000.50000
</td>
<td>
0.033300
</td>
<td>
0.294400
</td>
<td>
835.374886
</td>
<td>
33516.981876
</td>
</tr>
<tr>
<td>
std
</td>
<td>
2886.89568
</td>
<td>
0.179428
</td>
<td>
0.455795
</td>
<td>
483.714985
</td>
<td>
13336.639563
</td>
</tr>
<tr>
<td>
min
</td>
<td>
1.00000
</td>
<td>
0.000000
</td>
<td>
0.000000
</td>
<td>
0.000000
</td>
<td>
771.967729
</td>
</tr>
<tr>
<td>
25%
</td>
<td>
2500.75000
</td>
<td>
0.000000
</td>
<td>
0.000000
</td>
<td>
481.731105
</td>
<td>
21340.462903
</td>
</tr>
<tr>
<td>
50%
</td>
<td>
5000.50000
</td>
<td>
0.000000
</td>
<td>
0.000000
</td>
<td>
823.636973
</td>
<td>
34552.644802
</td>
</tr>
<tr>
<td>
75%
</td>
<td>
7500.25000
</td>
<td>
0.000000
</td>
<td>
1.000000
</td>
<td>
1166.308386
</td>
<td>
43807.729272
</td>
</tr>
<tr>
<td>
max
</td>
<td>
10000.00000
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
2654.322576
</td>
<td>
73554.233495
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="split-training-and-testing-set">split training and testing set</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co"># create features and target</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>features <span class="op">=</span> [<span class="st">&quot;balance&quot;</span>, <span class="st">&quot;income&quot;</span>]</span>
<span id="cb3-5"><a href="#cb3-5"></a>X <span class="op">=</span> default_data[features]</span>
<span id="cb3-6"><a href="#cb3-6"></a>y <span class="op">=</span> default_data.default</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co"># slipt data set into training and testing set</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>train_X, test_X, train_y, test_y <span class="op">=</span> train_test_split(X, y, train_size<span class="op">=</span><span class="fl">0.7</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="im">from</span> scipy <span class="im">import</span> linalg</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="im">from</span> matplotlib <span class="im">import</span> colors</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="im">from</span> sklearn.discriminant_analysis <span class="im">import</span> LinearDiscriminantAnalysis, QuadraticDiscriminantAnalysis</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span></code></pre></div>
<h2 id="plot-function">Plot function</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># set colormap</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>cmap <span class="op">=</span> colors.LinearSegmentedColormap(</span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="st">&#39;red_blue_classes&#39;</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>    {<span class="st">&#39;red&#39;</span>: [(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>)],</span>
<span id="cb5-5"><a href="#cb5-5"></a>     <span class="st">&#39;green&#39;</span>: [(<span class="dv">0</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>), (<span class="dv">1</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>)],</span>
<span id="cb5-6"><a href="#cb5-6"></a>     <span class="st">&#39;blue&#39;</span>: [(<span class="dv">0</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>), (<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)]})</span>
<span id="cb5-7"><a href="#cb5-7"></a>plt.cm.register_cmap(cmap<span class="op">=</span>cmap)</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co"># Plot function</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="kw">def</span> plot_data(model, X, y, y_pred):</span>
<span id="cb5-11"><a href="#cb5-11"></a></span>
<span id="cb5-12"><a href="#cb5-12"></a>    plt.ylabel(<span class="st">&#39;income&#39;</span>)</span>
<span id="cb5-13"><a href="#cb5-13"></a>    plt.xlabel(<span class="st">&#39;balance&#39;</span>)</span>
<span id="cb5-14"><a href="#cb5-14"></a>    </span>
<span id="cb5-15"><a href="#cb5-15"></a>    tp <span class="op">=</span> (y <span class="op">==</span> y_pred)  <span class="co"># True Positive</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>    tp0, tp1 <span class="op">=</span> tp[y <span class="op">==</span> <span class="dv">0</span>], tp[y <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb5-17"><a href="#cb5-17"></a>    X0, X1 <span class="op">=</span> X[y <span class="op">==</span> <span class="dv">0</span>], X[y <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb5-18"><a href="#cb5-18"></a>    X0_tp, X0_fp <span class="op">=</span> X0[tp0], X0[<span class="op">~</span>tp0]</span>
<span id="cb5-19"><a href="#cb5-19"></a>    X1_tp, X1_fp <span class="op">=</span> X1[tp1], X1[<span class="op">~</span>tp1]</span>
<span id="cb5-20"><a href="#cb5-20"></a></span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="co"># true class 0: dots, false class 0: x</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>    plt.scatter(X0_tp[<span class="st">&quot;balance&quot;</span>], X0_tp[<span class="st">&quot;income&quot;</span>], marker<span class="op">=</span><span class="st">&#39;.&#39;</span>, color<span class="op">=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb5-23"><a href="#cb5-23"></a>    plt.scatter(X0_fp[<span class="st">&quot;balance&quot;</span>], X0_fp[<span class="st">&quot;income&quot;</span>], marker<span class="op">=</span><span class="st">&#39;x&#39;</span>,</span>
<span id="cb5-24"><a href="#cb5-24"></a>                s<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">&#39;#990000&#39;</span>)  <span class="co"># dark red</span></span>
<span id="cb5-25"><a href="#cb5-25"></a></span>
<span id="cb5-26"><a href="#cb5-26"></a>    <span class="co"># true class 1: dots, false class 1: x</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>    plt.scatter(X1_tp[<span class="st">&quot;balance&quot;</span>], X1_tp[<span class="st">&quot;income&quot;</span>], marker<span class="op">=</span><span class="st">&#39;.&#39;</span>, color<span class="op">=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb5-28"><a href="#cb5-28"></a>    plt.scatter(X1_fp[<span class="st">&quot;balance&quot;</span>], X1_fp[<span class="st">&quot;income&quot;</span>], marker<span class="op">=</span><span class="st">&#39;x&#39;</span>,</span>
<span id="cb5-29"><a href="#cb5-29"></a>                s<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">&#39;#000099&#39;</span>)  <span class="co"># dark blue</span></span>
<span id="cb5-30"><a href="#cb5-30"></a></span>
<span id="cb5-31"><a href="#cb5-31"></a>    <span class="co"># class 0 and 1 : all areas for decision boundary</span></span>
<span id="cb5-32"><a href="#cb5-32"></a>    nx, ny <span class="op">=</span> <span class="dv">200</span>, <span class="dv">100</span></span>
<span id="cb5-33"><a href="#cb5-33"></a>    x_min, x_max <span class="op">=</span> plt.xlim()</span>
<span id="cb5-34"><a href="#cb5-34"></a>    y_min, y_max <span class="op">=</span> plt.ylim()</span>
<span id="cb5-35"><a href="#cb5-35"></a>    xx, yy <span class="op">=</span> np.meshgrid(np.linspace(x_min, x_max, nx),</span>
<span id="cb5-36"><a href="#cb5-36"></a>                         np.linspace(y_min, y_max, ny))</span>
<span id="cb5-37"><a href="#cb5-37"></a>    Z <span class="op">=</span> model.predict_proba(np.c_[xx.ravel(), yy.ravel()])</span>
<span id="cb5-38"><a href="#cb5-38"></a>    Z <span class="op">=</span> Z[:, <span class="dv">1</span>].reshape(xx.shape)</span>
<span id="cb5-39"><a href="#cb5-39"></a>    plt.pcolormesh(xx, yy, Z, cmap<span class="op">=</span><span class="st">&#39;red_blue_classes&#39;</span>,</span>
<span id="cb5-40"><a href="#cb5-40"></a>                   norm<span class="op">=</span>colors.Normalize(<span class="fl">0.</span>, <span class="fl">1.</span>), zorder<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb5-41"><a href="#cb5-41"></a>    </span>
<span id="cb5-42"><a href="#cb5-42"></a>    <span class="co"># plot decision boundary</span></span>
<span id="cb5-43"><a href="#cb5-43"></a>    plt.contour(xx, yy, Z, [<span class="fl">0.5</span>], linewidths<span class="op">=</span><span class="fl">2.</span>, colors<span class="op">=</span><span class="st">&#39;white&#39;</span>)</span>
<span id="cb5-44"><a href="#cb5-44"></a></span>
<span id="cb5-45"><a href="#cb5-45"></a>    plt.axis(<span class="st">&#39;tight&#39;</span>)</span>
<span id="cb5-46"><a href="#cb5-46"></a>    plt.tight_layout()</span>
<span id="cb5-47"><a href="#cb5-47"></a>    plt.subplots_adjust(top<span class="op">=</span><span class="fl">0.92</span>)</span>
<span id="cb5-48"><a href="#cb5-48"></a>    plt.show()</span></code></pre></div>
<h2 id="linear-discriminant-analysis">Linear Discriminant Analysis</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Linear Discriminant Analysis</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">7</span>), facecolor<span class="op">=</span><span class="st">&#39;white&#39;</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a>plt.title(<span class="st">&#39;Linear Discriminant Analysis&#39;</span>, y<span class="op">=</span><span class="dv">1</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a>lda <span class="op">=</span> LinearDiscriminantAnalysis(solver<span class="op">=</span><span class="st">&quot;svd&quot;</span>, store_covariance<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a>y_pred <span class="op">=</span> lda.fit(train_X, train_y).predict(test_X)</span>
<span id="cb6-7"><a href="#cb6-7"></a>plot_data(lda, test_X, test_y, y_pred)</span></code></pre></div>
<figure>
<img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/images/CreditCardFraudDetection/output_10_0.png" alt="" /><figcaption>png</figcaption>
</figure>
<h2 id="quadratic-discriminant-analysis">Quadratic Discriminant Analysis</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Quadratic Discriminant Analysis</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">7</span>), facecolor<span class="op">=</span><span class="st">&#39;white&#39;</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a>plt.title(<span class="st">&#39;Quadratic Discriminant Analysis&#39;</span>, y<span class="op">=</span><span class="dv">1</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a>qda <span class="op">=</span> QuadraticDiscriminantAnalysis(store_covariance<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a>y_pred <span class="op">=</span> qda.fit(train_X, train_y).predict(test_X)</span>
<span id="cb7-7"><a href="#cb7-7"></a>plot_data(qda, test_X, test_y, y_pred)</span></code></pre></div>
<figure>
<img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/images/CreditCardFraudDetection/output_12_0.png" alt="" /><figcaption>png</figcaption>
</figure>
<h2 id="use-logisticregression-directly-to-model-the-data">Use LogisticRegression directly to model the data</h2>
<p>If I use this data <strong>directly</strong> to feed the <code>LogisticRegression</code> model, the model will prefer to <strong>predict all as 0 for a high accuracy of 0 prediction.</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="bu">print</span>(default_data.default.value_counts(dropna <span class="op">=</span> <span class="va">False</span>))</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="bu">print</span>(<span class="st">&quot;The mean of default: &quot;</span>, default_data.default.mean())</span></code></pre></div>
<pre><code>0    9667
1     333
Name: default, dtype: int64
The mean of default:  0.0333</code></pre>
<p><strong>NOTE: As it showing above: the provided data with very low proportion of positive signals.</strong></p>
<p><strong>Conclusion: The provided data is imbalanced !</strong></p>
<p><strong>Solution: usually for imbalanced data, there are some solutions:</strong> 1. Collect more data 2. Down-Sampling or Over-Sampling to get balanced samples 3. Change the Thresholds to adjust the prediction 4. Assign class weights for the low rate class</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, auc, roc_curve, roc_auc_score, recall_score, precision_recall_curve</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> make_scorer, precision_score</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Xtrain, Xtest, ytrain, ytest = train_test_split(X, y, test_size = .33, stratify = y)</span></span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>logitreg_parameters <span class="op">=</span> {<span class="st">&#39;C&#39;</span>: np.power(<span class="fl">10.0</span>, np.arange(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>))}</span>
<span id="cb11-4"><a href="#cb11-4"></a>logitreg <span class="op">=</span> LogisticRegression(verbose <span class="op">=</span> <span class="dv">3</span>, warm_start <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>logitreg_grid <span class="op">=</span> GridSearchCV(logitreg, param_grid <span class="op">=</span> logitreg_parameters, scoring <span class="op">=</span> <span class="st">&#39;roc_auc&#39;</span>, n_jobs <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a>logitreg_grid.fit(train_X, train_y)</span></code></pre></div>
<pre><code>GridSearchCV(cv=None, error_score=nan,
             estimator=LogisticRegression(C=1.0, class_weight=None, dual=False,
                                          fit_intercept=True,
                                          intercept_scaling=1, l1_ratio=None,
                                          max_iter=100, multi_class=&#39;auto&#39;,
                                          n_jobs=None, penalty=&#39;l2&#39;,
                                          random_state=None, solver=&#39;lbfgs&#39;,
                                          tol=0.0001, verbose=3,
                                          warm_start=True),
             iid=&#39;deprecated&#39;, n_jobs=1,
             param_grid={&#39;C&#39;: array([1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02])},
             pre_dispatch=&#39;2*n_jobs&#39;, refit=True, return_train_score=False,
             scoring=&#39;roc_auc&#39;, verbose=0)</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># draw decision boundary with LogisticRegression directly</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">7</span>), facecolor<span class="op">=</span><span class="st">&#39;white&#39;</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a>plt.title(<span class="st">&#39;Logistic Regression directly&#39;</span>, y<span class="op">=</span><span class="dv">1</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a>y_pred <span class="op">=</span> logitreg_grid.predict(test_X)</span>
<span id="cb13-6"><a href="#cb13-6"></a>splot <span class="op">=</span> plot_data(logitreg_grid, test_X, test_y, y_pred)</span></code></pre></div>
<figure>
<img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/images/CreditCardFraudDetection/output_19_0.png" alt="" /><figcaption>png</figcaption>
</figure>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># on OVER-Sampled TRAINing data</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> The recall score on Training data is:&quot;</span>, </span>
<span id="cb14-3"><a href="#cb14-3"></a>      recall_score(train_y, logitreg_grid.predict(train_X))) <span class="co"># 0.32</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> The precision score on Training data is:&quot;</span>,</span>
<span id="cb14-5"><a href="#cb14-5"></a>      precision_score(train_y, logitreg_grid.predict(train_X))) <span class="co"># 0.74</span></span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co"># on the separated </span><span class="al">TEST</span><span class="co"> data</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Thre recall score on Test data is:&quot;</span>, </span>
<span id="cb14-9"><a href="#cb14-9"></a>      recall_score(test_y, logitreg_grid.predict(test_X))) <span class="co"># 0.32</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Thre precision score on Test data is:&quot;</span>, </span>
<span id="cb14-11"><a href="#cb14-11"></a>      precision_score(test_y, logitreg_grid.predict(test_X))) <span class="co"># 0.75</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Thre Confusion Matrix on Test data is:&quot;</span>, </span>
<span id="cb14-13"><a href="#cb14-13"></a>      confusion_matrix(test_y, logitreg_grid.predict(test_X))) <span class="co"># [[3178   12][  74   36]]</span></span></code></pre></div>
<pre><code> The recall score on Training data is: 0.32231404958677684

 The precision score on Training data is: 0.7222222222222222

 Thre recall score on Test data is: 0.3626373626373626

 Thre precision score on Test data is: 0.673469387755102

 Thre Confusion Matrix on Test data is: [[2893   16]
 [  58   33]]</code></pre>
<p><strong>Conclusions:</strong></p>
<p>From the output above, on the training data, the recall score is 0.32 which means 32 over 100 of the True positive conditions are predicted correctly. And 74 over 100 of the predicted positives are True Positive.</p>
<p>On the Test data, the model performance metric evalued by recall or precision are close to the Training data. There is a precision score of 0.81 on the Test data, which means 81 out of 100 predicted positives are True positives.</p>
<p>From Confusion Matrix, 36 of 110 True Positives are predicted as positives. And of all 48 predicted as positive, 36 of them are True positives.</p>
<h3 id="change-the-thresholds">Change the Thresholds</h3>
<h4 id="plot-roc-curve">plot roc curve</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">def</span> plot_roc(new_thresholds, logitreg_grid):</span>
<span id="cb16-2"><a href="#cb16-2"></a>    y_train_pred_probas <span class="op">=</span> logitreg_grid.predict_proba(train_X)[:, <span class="dv">1</span>]   <span class="co"># prob of predict as 1</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>    fpr, tpr, thresholds <span class="op">=</span> roc_curve(train_y, y_train_pred_probas)   <span class="co"># precision_recall_curve</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>    roc <span class="op">=</span> pd.DataFrame({<span class="st">&#39;FPR&#39;</span>:fpr, <span class="st">&#39;TPR&#39;</span>:tpr, <span class="st">&#39;Thresholds&#39;</span>:thresholds})</span>
<span id="cb16-5"><a href="#cb16-5"></a>    plt.figure()</span>
<span id="cb16-6"><a href="#cb16-6"></a>    plt.title(<span class="st">&#39;ROC Curve&#39;</span>, y <span class="op">=</span> <span class="dv">1</span>, fontsize <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb16-7"><a href="#cb16-7"></a>    plt.plot(roc.FPR, roc.TPR)</span>
<span id="cb16-8"><a href="#cb16-8"></a>    plt.axvline(new_thresholds, color <span class="op">=</span> <span class="st">&#39;#00C851&#39;</span>, linestyle <span class="op">=</span> <span class="st">&#39;--&#39;</span>)</span>
<span id="cb16-9"><a href="#cb16-9"></a>    plt.xlabel(<span class="st">&quot;FPR&quot;</span>)</span>
<span id="cb16-10"><a href="#cb16-10"></a>    plt.ylabel(<span class="st">&quot;TPR&quot;</span>)</span>
<span id="cb16-11"><a href="#cb16-11"></a>    plt.show()</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a>new_threshold <span class="op">=</span> <span class="fl">0.1</span>   <span class="co"># 0.5 is the default value</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>plot_roc(new_threshold, logitreg_grid)</span></code></pre></div>
<figure>
<img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/images/CreditCardFraudDetection/output_24_0.png" alt="" /><figcaption>png</figcaption>
</figure>
<p>By default, the threshold is 0.5. Since the recall score is low, I'm trying to <strong>lower the threshold</strong> to get more predicted as Positive. At the same time, more True Negative data will be falsely predicted as Positive. So the Precision score will be lower.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>y_test_pred_probas <span class="op">=</span> logitreg_grid.predict_proba(test_X)[:, <span class="dv">1</span>]</span>
<span id="cb18-2"><a href="#cb18-2"></a>y_test_pred <span class="op">=</span> (y_test_pred_probas <span class="op">&gt;=</span> new_threshold).astype(<span class="bu">int</span>)</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="bu">print</span>(<span class="st">&quot;After change threshold to 0.1, the recall socre on Test data is:&quot;</span>)</span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="bu">print</span>(recall_score(test_y, y_test_pred))     <span class="co"># 0.736</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="bu">print</span>(<span class="st">&quot;After change threshold to 0.1, the precision socre on Test data is:&quot;</span>)</span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="bu">print</span>(precision_score(test_y, y_test_pred))  <span class="co"># 0.301</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="bu">print</span>(<span class="st">&quot;After change threshold to 0.1, the Confusion Matrix on Test data is:&quot;</span>)</span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="bu">print</span>(confusion_matrix(test_y, y_test_pred)) <span class="co"># [[3002  188][  29   81]]</span></span></code></pre></div>
<pre><code>After change threshold to 0.1, the recall socre on Test data is:
0.7142857142857143
After change threshold to 0.1, the precision socre on Test data is:
0.25
After change threshold to 0.1, the Confusion Matrix on Test data is:
[[2714  195]
 [  26   65]]</code></pre>
<h2 id="create-over-sampling-data-and-fit-the-model">Create Over-sampling data and Fit the model</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>oversample_ratio <span class="op">=</span> <span class="bu">sum</span>(train_y <span class="op">==</span> <span class="dv">0</span>) <span class="op">/</span> <span class="bu">sum</span>(train_y <span class="op">==</span> <span class="dv">1</span>)  <span class="co"># size to repeat y == 1</span></span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co"># repeat the positive data for X and y</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>y_train_pos_oversample <span class="op">=</span> pd.concat([train_y[train_y<span class="op">==</span><span class="dv">1</span>]] <span class="op">*</span> <span class="bu">int</span>(oversample_ratio), axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb20-5"><a href="#cb20-5"></a>X_train_pos_oversample <span class="op">=</span> pd.concat([train_X.loc[train_y<span class="op">==</span><span class="dv">1</span>, :]] <span class="op">*</span> <span class="bu">int</span>(oversample_ratio), axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co"># concat the repeated data with the original data together</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>y_train_oversample <span class="op">=</span> pd.concat([train_y, y_train_pos_oversample], axis <span class="op">=</span> <span class="dv">0</span>).reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb20-9"><a href="#cb20-9"></a>X_train_oversample <span class="op">=</span> pd.concat([train_X, X_train_pos_oversample], axis <span class="op">=</span> <span class="dv">0</span>).reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb20-10"><a href="#cb20-10"></a></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="bu">print</span>(y_train_oversample.value_counts(dropna <span class="op">=</span> <span class="va">False</span>, normalize <span class="op">=</span> <span class="va">True</span>))</span>
<span id="cb20-12"><a href="#cb20-12"></a></span>
<span id="cb20-13"><a href="#cb20-13"></a>logitreg_parameters <span class="op">=</span> {<span class="st">&#39;C&#39;</span>: np.power(<span class="fl">10.0</span>, np.arange(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>))}</span>
<span id="cb20-14"><a href="#cb20-14"></a>logitreg <span class="op">=</span> LogisticRegression(verbose <span class="op">=</span> <span class="dv">3</span>, warm_start <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb20-15"><a href="#cb20-15"></a>logitreg_grid <span class="op">=</span> GridSearchCV(logitreg, param_grid <span class="op">=</span> logitreg_parameters, scoring <span class="op">=</span> <span class="st">&#39;roc_auc&#39;</span>, n_jobs <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb20-16"><a href="#cb20-16"></a></span>
<span id="cb20-17"><a href="#cb20-17"></a>logitreg_grid.fit(X_train_oversample, y_train_oversample) </span></code></pre></div>
<pre><code>1    0.500665
0    0.499335
Name: default, dtype: float64
GridSearchCV(cv=None, error_score=nan,
             estimator=LogisticRegression(C=1.0, class_weight=None, dual=False,
                                          fit_intercept=True,
                                          intercept_scaling=1, l1_ratio=None,
                                          max_iter=100, multi_class=&#39;auto&#39;,
                                          n_jobs=None, penalty=&#39;l2&#39;,
                                          random_state=None, solver=&#39;lbfgs&#39;,
                                          tol=0.0001, verbose=3,
                                          warm_start=True),
             iid=&#39;deprecated&#39;, n_jobs=1,
             param_grid={&#39;C&#39;: array([1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02])},
             pre_dispatch=&#39;2*n_jobs&#39;, refit=True, return_train_score=False,
             scoring=&#39;roc_auc&#39;, verbose=0)</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Logistic Regression with Over-sampling</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">7</span>), facecolor<span class="op">=</span><span class="st">&#39;white&#39;</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a>plt.title(<span class="st">&#39;Logistic Regression with Over-sampling&#39;</span>, y<span class="op">=</span><span class="dv">1</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a>y_pred <span class="op">=</span> logitreg_grid.predict(test_X)</span>
<span id="cb22-6"><a href="#cb22-6"></a>plot_data(logitreg_grid, test_X, test_y, y_pred)</span></code></pre></div>
<figure>
<img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/images/CreditCardFraudDetection/output_29_0.png" alt="" /><figcaption>png</figcaption>
</figure>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># on OVER-Sampled TRAINing data</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="bu">print</span>(<span class="st">&quot;After Over-Sampling, the recall score on Training data is&quot;</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="bu">print</span>(recall_score(y_train_oversample, logitreg_grid.predict(X_train_oversample)))    <span class="co"># 0.865</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="bu">print</span>(<span class="st">&quot;After Over-Sampling, the precision score on Training data is&quot;</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="bu">print</span>(precision_score(y_train_oversample, logitreg_grid.predict(X_train_oversample)))   <span class="co"># 0.727</span></span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co"># on the TESTing data</span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="bu">print</span>(<span class="st">&quot;After Over-Sampling, the recall score on Test data is&quot;</span>)</span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="bu">print</span>(recall_score(test_y, logitreg_grid.predict(test_X)))   <span class="co">#  0.854</span></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="bu">print</span>(<span class="st">&quot;After Over-Sampling, the precision score on Test data is&quot;</span>)</span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="bu">print</span>(precision_score(test_y, logitreg_grid.predict(test_X)))   <span class="co"># 0.080</span></span>
<span id="cb23-12"><a href="#cb23-12"></a><span class="bu">print</span>(<span class="st">&quot;After Over-Sampling, the Confusion Matrix on Test data is&quot;</span>)</span>
<span id="cb23-13"><a href="#cb23-13"></a><span class="bu">print</span>(confusion_matrix(test_y, logitreg_grid.predict(test_X))) <span class="co"># [[2113 1077][  16   94]]</span></span></code></pre></div>
<pre><code>After Over-Sampling, the recall score on Training data is
0.8884297520661157
After Over-Sampling, the precision score on Training data is
0.8717057631045467
After Over-Sampling, the recall score on Test data is
0.8791208791208791
After Over-Sampling, the precision score on Test data is
0.17094017094017094
After Over-Sampling, the Confusion Matrix on Test data is
[[2521  388]
 [  11   80]]</code></pre>
<p><strong>Conclusion:</strong> From the output above, on the training data, the recall score is 0.865 which means 86.5 over 100 of the True conditions are predicted correctly. And 85.4 over 100 of the predicted positives are really positive.</p>
<p>However, there is only a precision score of 0.080 on the Test data, which means only 8 out of 100 predicted positives are real positives.</p>
<p>From Confusion Matrix, 94 of 110 True Positives are predicted as positives. However, the model predicted 1077 Negative data as Positive.</p>
<p>That is, this model has pretty strong <strong>over-fitting</strong>.</p>
<h3 id="change-the-thresholds-1">Change the Thresholds</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>new_threshold <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>plot_roc(new_threshold, logitreg_grid)</span></code></pre></div>
<figure>
<img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/images/CreditCardFraudDetection/output_33_0.png" alt="" /><figcaption>png</figcaption>
</figure>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>y_test_pred_probas <span class="op">=</span> logitreg_grid.predict_proba(test_X)[:, <span class="dv">1</span>]</span>
<span id="cb26-2"><a href="#cb26-2"></a>y_test_pred <span class="op">=</span> (y_test_pred_probas <span class="op">&gt;=</span> new_threshold).astype(<span class="bu">int</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="bu">print</span>(<span class="st">&quot;After change threshold to 0.2, the recall socre on Test data is:&quot;</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="bu">print</span>(recall_score(test_y, y_test_pred)) <span class="co"># 0.990</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="bu">print</span>(<span class="st">&quot;After change threshold to 0.2, the precision socre on Test data is:&quot;</span>)</span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="bu">print</span>(precision_score(test_y, y_test_pred)) <span class="co"># 0.047</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="bu">print</span>(<span class="st">&quot;After change threshold to 0.2, the Confusion Matrix on Test data is:&quot;</span>)</span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="bu">print</span>(confusion_matrix(test_y, y_test_pred)) <span class="co"># [[ 1013 2177][   1  109]]</span></span></code></pre></div>
<pre><code>After change threshold to 0.2, the recall socre on Test data is:
0.9340659340659341
After change threshold to 0.2, the precision socre on Test data is:
0.10023584905660378
After change threshold to 0.2, the Confusion Matrix on Test data is:
[[2146  763]
 [   6   85]]</code></pre>
<p><strong>Conclusion:</strong> After <strong>over-sampling</strong>, the model will have <strong>higher recall rate</strong>. That is, the model will work better on detect the Frauds from True Frauds. The price is the <strong>lower precision rate</strong>.</p>
<h2 id="logistic-regression-with-class_weight">Logistic Regression with class_weight</h2>
<p>Rather than over-sampling, we can <strong>assign more weights to the lower rate class.</strong></p>
<p>we can write out the Likelihood function for Logistic Regression, the Over-Sampling and the assigning more Weights will be equivalent.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>positive_weight <span class="op">=</span> <span class="bu">sum</span>(train_y <span class="op">==</span> <span class="dv">0</span>) <span class="op">/</span> <span class="bu">sum</span>(train_y <span class="op">==</span> <span class="dv">1</span>)  <span class="co"># size to repeat y == 1</span></span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a>logitreg_parameters <span class="op">=</span> {<span class="st">&#39;C&#39;</span>: np.power(<span class="fl">10.0</span>, np.arange(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>))}</span>
<span id="cb28-4"><a href="#cb28-4"></a>logitreg <span class="op">=</span> LogisticRegression(class_weight <span class="op">=</span> {<span class="dv">0</span> : <span class="dv">1</span>, <span class="dv">1</span> : positive_weight}, verbose <span class="op">=</span> <span class="dv">3</span>, warm_start <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb28-5"><a href="#cb28-5"></a>logitreg_grid <span class="op">=</span> GridSearchCV(logitreg, param_grid <span class="op">=</span> logitreg_parameters, scoring <span class="op">=</span> <span class="st">&#39;roc_auc&#39;</span>, n_jobs <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a>logitreg_grid.fit(train_X, train_y)</span></code></pre></div>
<pre><code>GridSearchCV(cv=None, error_score=nan,
             estimator=LogisticRegression(C=1.0,
                                          class_weight={0: 1,
                                                        1: 27.925619834710744},
                                          dual=False, fit_intercept=True,
                                          intercept_scaling=1, l1_ratio=None,
                                          max_iter=100, multi_class=&#39;auto&#39;,
                                          n_jobs=None, penalty=&#39;l2&#39;,
                                          random_state=None, solver=&#39;lbfgs&#39;,
                                          tol=0.0001, verbose=3,
                                          warm_start=True),
             iid=&#39;deprecated&#39;, n_jobs=1,
             param_grid={&#39;C&#39;: array([1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02])},
             pre_dispatch=&#39;2*n_jobs&#39;, refit=True, return_train_score=False,
             scoring=&#39;roc_auc&#39;, verbose=0)</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Logistic Regression with class_weight</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">7</span>), facecolor<span class="op">=</span><span class="st">&#39;white&#39;</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a>plt.title(<span class="st">&#39;Logistic Regression&#39;</span>, y<span class="op">=</span><span class="dv">1</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb30-4"><a href="#cb30-4"></a></span>
<span id="cb30-5"><a href="#cb30-5"></a>y_pred <span class="op">=</span> logitreg_grid.predict(test_X)</span>
<span id="cb30-6"><a href="#cb30-6"></a>plot_data(logitreg_grid, test_X, test_y, y_pred)</span></code></pre></div>
<figure>
<img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/images/CreditCardFraudDetection/output_38_0.png" alt="" /><figcaption>png</figcaption>
</figure>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="bu">print</span>(<span class="st">&quot;After assign class_weight, the recall score on Training data is&quot;</span>)</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="bu">print</span>(recall_score(y_train_oversample, logitreg_grid.predict(X_train_oversample)))    <span class="co"># 0.856</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="bu">print</span>(<span class="st">&quot;After assign class_weight, the precision score on Training data is&quot;</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="bu">print</span>(precision_score(y_train_oversample, logitreg_grid.predict(X_train_oversample)))   <span class="co"># 0.729</span></span>
<span id="cb31-5"><a href="#cb31-5"></a></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="co"># on the separated </span><span class="al">TEST</span><span class="co"> data</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="bu">print</span>(<span class="st">&quot;After assign class_weight, the recall score on Test data is&quot;</span>)</span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="bu">print</span>(recall_score(test_y, logitreg_grid.predict(test_X)))   <span class="co"># 0.845</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="bu">print</span>(<span class="st">&quot;After assign class_weight, the precision score on Test data is&quot;</span>)</span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="bu">print</span>(precision_score(test_y, logitreg_grid.predict(test_X)))   <span class="co"># 0.081</span></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="bu">print</span>(<span class="st">&quot;After assign class_weight, the Confusion Matrix on Test data is&quot;</span>)</span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="bu">print</span>(confusion_matrix(test_y, logitreg_grid.predict(test_X))) <span class="co"># [[2135 1055] [  17   93]]</span></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="bu">print</span>(<span class="st">&quot;After assign class_weight, the ROC AUC Score on Test data is&quot;</span>)</span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="bu">print</span>(roc_auc_score(test_y, logitreg_grid.predict(test_X))) <span class="co"># 0.757</span></span></code></pre></div>
<pre><code>After assign class_weight, the recall score on Training data is
0.859504132231405
After assign class_weight, the precision score on Training data is
0.7171530599679843
After assign class_weight, the recall score on Test data is
0.8791208791208791
After assign class_weight, the precision score on Test data is
0.075046904315197
After assign class_weight, the Confusion Matrix on Test data is
[[1923  986]
 [  11   80]]
After assign class_weight, the ROC AUC Score on Test data is
0.7700863934965</code></pre>
<p><strong>Conclusion:</strong> If I set up the class weight for the positive as the ratio of non-Fault / Fault, I will get the result close to the over-sampling.</p>
<p>So, in summary: This specific data is about <strong>fraud detection</strong>. So the model should <strong>focus on to find the frauds to avoid potential loss for the bank</strong>. That is, we focus on <strong>recall rate</strong>.</p>
<h1 id="conclusion">Conclusion</h1>
<ol type="1">
<li>If we use the imbalanced data directly, we will get low performance model since the model prefer to predict to the class with dominated frequency class. The recall rate is 0.31. That is, only 31% of the frauds can be detected by this model.</li>
<li>To fix that, one way is to do over-sampling or down-sampling. If we use over-sampling, the model performance will be improved a lot. For this specific case, the recall rate on the independent test set will be improved from 0.31 to 0.87</li>
<li>Another way to improve the model performance is to assign more weights to the low frequency class. Generally speaking, for Logistic Regression, assigning weights is similar to over-sampling, from the likelihood function perspective. The final output results are close too as demonstrated above.</li>
</ol>
<h1 id="reference">Reference</h1>
<ol type="1">
<li><a href="!https://songhuiming.github.io/pages/2018/05/05/credit-card-fraud-detection-imbalanced-data-modeling-part-i-logistic-regression/">Credit Card Fraud Detection / Imbalanced data modeling - Part I: Logistic Regression</a></li>
<li><a href="!https://www.kaggle.com/janiobachmann/credit-fraud-dealing-with-imbalanced-datasets">Credit Fraud || Dealing with Imbalanced Datasets</a></li>
</ol>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/custom/donate/AliPayQR.jpg"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/custom/donate/WeChanQR.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2020/04/01/Technology/Leetcode-Note-in-Apri-2020-part-1-day-01-07/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/photos/coding/leetcode_01.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/photos/coding/leetcode_01.png">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                Leetcode Note in Apri 2020 | part 1 | day 01-07</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2019/12/29/Technology/Evalution%20of%20hair%20and%20scalp%20condition%20based%20on%20microscopy%20image%20analysis%20%20%7C%20Hair%20Thickness%20-%201/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/photos/hair/hair_thickness_01.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/article_img/photos/hair/hair_thickness_01.jpg">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                Evalution of hair and scalp condition based on microscopy image analysis | Hair Thickness - part 1</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "uVn0CbsTzphCnMDIxJKQ0rbg-gzGzoHsz",
        appKey: "wc39UmG3dNqQQms9Hg2sKc1X",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="https://littlelittlemoon.github.io/" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/custom/avatar-3.jpg" itemprop="image" alt="Kayleen" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="https://littlelittlemoon.github.io/" itemprop="url" rel="author">Kayleen</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>A curious 👱‍♀️</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>


  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>


    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            // PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Kayleen<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun&Kayleen</a>, Powered by Hexo, Hosted by Github Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/video","name":"we-bare-bears-ice-bear-play-2.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/video","name":"we-bare-bears-ice-bear-play-2.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/littlelittlemoon/cdn/img/custom/avatar-3.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">Bear CaveKayleen</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/littlelittlemoon" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://wpa.qq.com/msgrd?v=3&uin=1165156282&site=qq&menu=yes" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/Technology/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/Life/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
              <li>
                <a href="/categories/Thoughts/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  随想
                </a>
              </li>
            
              <li>
                <a href="/categories/Repost/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  转载
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/Reading/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  悦读
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  音悦
                </a>
              </li>
            
              <li>
                <a href="/tags/Pictures/">
                  <i class="fa fa-photo" aria-hidden="true"></i>
                  图集
                </a>
              </li>
            
              <li>
                <a href="/tags/Cave/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  Cave
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/donate/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
            赞赏
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/about/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-meetup" aria-hidden="true"></i>
            关于我
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="2188265841"

    server="netease"

    type="playlist"

    fixed="true"

    mini="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.4"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>